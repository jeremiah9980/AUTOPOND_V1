import{b as P}from"./chunk-3C6TN75L.js";import{jb as we,m as xe,n as K}from"./chunk-ZZPI23JA.js";import{w as ye}from"./chunk-2THQDEWP.js";import{a as q,b as Se}from"./chunk-YOIJCLV6.js";import{w as Re,x as L}from"./chunk-P4LRI3S3.js";import{C as pe,D as de,E as fe,F as le,G as me,I as ge,M as he,x as ce,z as E}from"./chunk-GBKSQA4Y.js";import{Ma as ie,Nb as ae,S as b,gb as k,gd as ue}from"./chunk-S6KJ2BHO.js";import{N as te}from"./chunk-7ZZNCPHU.js";import{Fa as ne,Ga as se,Ka as oe,xa as w}from"./chunk-NMZ7IVPZ.js";import{X as re,v}from"./chunk-H6ILHDLW.js";import{c as D,d as ze,f as V,h as c,m as Buffer,n as p}from"./chunk-3KENBVE7.js";var Te=D(C=>{"use strict";c();p();Object.defineProperty(C,"__esModule",{value:!0});C.TokenData=void 0;C.parse=z;C.compile=ft;C.match=mt;C.pathToRegexp=Ee;C.stringify=yt;var _="/",j=e=>e,Ie=/^[$_\p{ID_Start}]$/u,F=/^[$\u200c\u200d\p{ID_Continue}]$/u,N="https://git.new/pathToRegexpError",ct={"{":"{","}":"}","(":"(",")":")","[":"[","]":"]","+":"+","?":"?","!":"!"};function pt(e){return e.replace(/[{}()\[\]+?!:*]/g,"\\$&")}function x(e){return e.replace(/[.+*?^${}()[\]|/\\]/g,"\\$&")}function*dt(e){let t=[...e],r=0;function n(){let s="";if(Ie.test(t[++r]))for(s+=t[r];F.test(t[++r]);)s+=t[r];else if(t[r]==='"'){let o=r;for(;r<t.length;){if(t[++r]==='"'){r++,o=0;break}t[r]==="\\"?s+=t[++r]:s+=t[r]}if(o)throw new TypeError(`Unterminated quote at ${o}: ${N}`)}if(!s)throw new TypeError(`Missing parameter name at ${r}: ${N}`);return s}for(;r<t.length;){let s=t[r],o=ct[s];if(o)yield{type:o,index:r++,value:s};else if(s==="\\")yield{type:"ESCAPED",index:r++,value:t[r++]};else if(s===":"){let a=n();yield{type:"PARAM",index:r,value:a}}else if(s==="*"){let a=n();yield{type:"WILDCARD",index:r,value:a}}else yield{type:"CHAR",index:r,value:t[r++]}}return{type:"END",index:r,value:""}}var W=class{constructor(t){this.tokens=t}peek(){if(!this._peek){let t=this.tokens.next();this._peek=t.value}return this._peek}tryConsume(t){let r=this.peek();if(r.type===t)return this._peek=void 0,r.value}consume(t){let r=this.tryConsume(t);if(r!==void 0)return r;let{type:n,index:s}=this.peek();throw new TypeError(`Unexpected ${n} at ${s}, expected ${t}: ${N}`)}text(){let t="",r;for(;r=this.tryConsume("CHAR")||this.tryConsume("ESCAPED");)t+=r;return t}},A=class{constructor(t){this.tokens=t}};C.TokenData=A;function z(e,t={}){let{encodePath:r=j}=t,n=new W(dt(e));function s(a){let u=[];for(;;){let f=n.text();f&&u.push({type:"text",value:r(f)});let l=n.tryConsume("PARAM");if(l){u.push({type:"param",name:l});continue}let g=n.tryConsume("WILDCARD");if(g){u.push({type:"wildcard",name:g});continue}if(n.tryConsume("{")){u.push({type:"group",tokens:s("}")});continue}return n.consume(a),u}}let o=s("END");return new A(o)}function ft(e,t={}){let{encode:r=encodeURIComponent,delimiter:n=_}=t,s=e instanceof A?e:z(e,t),o=Ae(s.tokens,n,r);return function(u={}){let[f,...l]=o(u);if(l.length)throw new TypeError(`Missing parameters: ${l.join(", ")}`);return f}}function Ae(e,t,r){let n=e.map(s=>lt(s,t,r));return s=>{let o=[""];for(let a of n){let[u,...f]=a(s);o[0]+=u,o.push(...f)}return o}}function lt(e,t,r){if(e.type==="text")return()=>[e.value];if(e.type==="group"){let s=Ae(e.tokens,t,r);return o=>{let[a,...u]=s(o);return u.length?[""]:[a]}}let n=r||j;return e.type==="wildcard"&&r!==!1?s=>{let o=s[e.name];if(o==null)return["",e.name];if(!Array.isArray(o)||o.length===0)throw new TypeError(`Expected "${e.name}" to be a non-empty array`);return[o.map((a,u)=>{if(typeof a!="string")throw new TypeError(`Expected "${e.name}/${u}" to be a string`);return n(a)}).join(t)]}:s=>{let o=s[e.name];if(o==null)return["",e.name];if(typeof o!="string")throw new TypeError(`Expected "${e.name}" to be a string`);return[n(o)]}}function mt(e,t={}){let{decode:r=decodeURIComponent,delimiter:n=_}=t,{regexp:s,keys:o}=Ee(e,t),a=o.map(u=>r===!1?j:u.type==="param"?r:f=>f.split(n).map(r));return function(f){let l=s.exec(f);if(!l)return!1;let g=l[0],h=Object.create(null);for(let y=1;y<l.length;y++){if(l[y]===void 0)continue;let R=o[y-1],H=a[y-1];h[R.name]=H(l[y])}return{path:g,params:h}}}function Ee(e,t={}){let{delimiter:r=_,end:n=!0,sensitive:s=!1,trailing:o=!0}=t,a=[],u=[],f=s?"":"i",g=(Array.isArray(e)?e:[e]).map(R=>R instanceof A?R:z(R,t));for(let{tokens:R}of g)for(let H of M(R,0,[])){let Fe=gt(H,r,a);u.push(Fe)}let h=`^(?:${u.join("|")})`;return o&&(h+=`(?:${x(r)}$)?`),h+=n?"$":`(?=${x(r)}|$)`,{regexp:new RegExp(h,f),keys:a}}function*M(e,t,r){if(t===e.length)return yield r;let n=e[t];if(n.type==="group"){let s=r.slice();for(let o of M(n.tokens,0,s))yield*M(e,t+1,o)}else r.push(n);yield*M(e,t+1,r)}function gt(e,t,r){let n="",s="",o=!0;for(let a=0;a<e.length;a++){let u=e[a];if(u.type==="text"){n+=x(u.value),s+=u.value,o||(o=u.value.includes(t));continue}if(u.type==="param"||u.type==="wildcard"){if(!o&&!s)throw new TypeError(`Missing text after "${u.name}": ${N}`);u.type==="param"?n+=`(${ht(t,o?"":s)}+)`:n+="([\\s\\S]+)",r.push(u),s="",o=!1;continue}}return n}function ht(e,t){return t.length<2?e.length<2?`[^${x(e+t)}]`:`(?:(?!${x(e)})[^${x(t)}])`:e.length<2?`(?:(?!${x(t)})[^${x(e)}])`:`(?:(?!${x(t)}|${x(e)})[\\s\\S])`}function yt(e){return e.tokens.map(function t(r,n,s){if(r.type==="text")return pt(r.value);if(r.type==="group")return`{${r.tokens.map(t).join("")}}`;let a=Rt(r.name)&&xt(s[n+1])?r.name:JSON.stringify(r.name);if(r.type==="param")return`:${a}`;if(r.type==="wildcard")return`*${a}`;throw new TypeError(`Unexpected token: ${r}`)}).join("")}function Rt(e){let[t,...r]=e;return Ie.test(t)?r.every(n=>F.test(n)):!1}function xt(e){return e?.type!=="text"?!0:!F.test(e.value[0])}});var B=D(d=>{"use strict";c();p();Object.defineProperty(d,"__esModule",{value:!0});d.isHexString=d.getKeys=d.fromAscii=d.fromUtf8=d.toAscii=d.arrayContainsArray=d.getBinarySize=d.padToEven=d.stripHexPrefix=d.isHexPrefixed=void 0;function Me(e){if(typeof e!="string")throw new Error(`[isHexPrefixed] input must be type 'string', received type ${typeof e}`);return e[0]==="0"&&e[1]==="x"}d.isHexPrefixed=Me;var qt=e=>{if(typeof e!="string")throw new Error(`[stripHexPrefix] input must be type 'string', received ${typeof e}`);return Me(e)?e.slice(2):e};d.stripHexPrefix=qt;function Ne(e){let t=e;if(typeof t!="string")throw new Error(`[padToEven] value must be type 'string', received ${typeof t}`);return t.length%2&&(t=`0${t}`),t}d.padToEven=Ne;function Pt(e){if(typeof e!="string")throw new Error(`[getBinarySize] method requires input type 'string', received ${typeof e}`);return Buffer.byteLength(e,"utf8")}d.getBinarySize=Pt;function Mt(e,t,r){if(Array.isArray(e)!==!0)throw new Error(`[arrayContainsArray] method requires input 'superset' to be an array, got type '${typeof e}'`);if(Array.isArray(t)!==!0)throw new Error(`[arrayContainsArray] method requires input 'subset' to be an array, got type '${typeof t}'`);return t[r===!0?"some":"every"](n=>e.indexOf(n)>=0)}d.arrayContainsArray=Mt;function Nt(e){let t="",r=0,n=e.length;for(e.substring(0,2)==="0x"&&(r=2);r<n;r+=2){let s=parseInt(e.substr(r,2),16);t+=String.fromCharCode(s)}return t}d.toAscii=Nt;function Ut(e){let t=Buffer.from(e,"utf8");return`0x${Ne(t.toString("hex")).replace(/^0+|0+$/g,"")}`}d.fromUtf8=Ut;function Bt(e){let t="";for(let r=0;r<e.length;r++){let s=e.charCodeAt(r).toString(16);t+=s.length<2?`0${s}`:s}return`0x${t}`}d.fromAscii=Bt;function $t(e,t,r){if(!Array.isArray(e))throw new Error(`[getKeys] method expects input 'params' to be an array, got ${typeof e}`);if(typeof t!="string")throw new Error(`[getKeys] method expects input 'key' to be type 'string', got ${typeof e}`);let n=[];for(let s=0;s<e.length;s++){let o=e[s][t];if(r===!0&&!o)o="";else if(typeof o!="string")throw new Error(`invalid abi - expected type 'string', received ${typeof o}`);n.push(o)}return n}d.getKeys=$t;function Ot(e,t){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||typeof t<"u"&&t>0&&e.length!==2+2*t)}d.isHexString=Ot});var Ue=D(S=>{"use strict";c();p();Object.defineProperty(S,"__esModule",{value:!0});S.assertIsString=S.assertIsArray=S.assertIsBuffer=S.assertIsHexString=void 0;var Ht=B(),Vt=function(e){if(!(0,Ht.isHexString)(e)){let t=`This method only supports 0x-prefixed hex strings but input was: ${e}`;throw new Error(t)}};S.assertIsHexString=Vt;var Lt=function(e){if(!Buffer.isBuffer(e)){let t=`This method only supports Buffer but input was: ${e}`;throw new Error(t)}};S.assertIsBuffer=Lt;var Kt=function(e){if(!Array.isArray(e)){let t=`This method only supports number arrays but input was: ${e}`;throw new Error(t)}};S.assertIsArray=Kt;var Wt=function(e){if(typeof e!="string"){let t=`This method only supports strings but input was: ${e}`;throw new Error(t)}};S.assertIsString=Wt});var He=D(i=>{"use strict";c();p();Object.defineProperty(i,"__esModule",{value:!0});i.intToUnpaddedBuffer=i.bigIntToUnpaddedBuffer=i.bigIntToHex=i.bufArrToArr=i.arrToBufArr=i.validateNoLeadingZeroes=i.baToJSON=i.toUtf8=i.short=i.addHexPrefix=i.toUnsigned=i.fromSigned=i.bufferToInt=i.bigIntToBuffer=i.bufferToBigInt=i.bufferToHex=i.toBuffer=i.unpadHexString=i.unpadArray=i.unpadBuffer=i.setLengthRight=i.setLengthLeft=i.zeros=i.intToBuffer=i.intToHex=void 0;var T=Ue(),I=B(),_t=function(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Received an invalid integer type: ${e}`);return`0x${e.toString(16)}`};i.intToHex=_t;var jt=function(e){let t=(0,i.intToHex)(e);return Buffer.from((0,I.padToEven)(t.slice(2)),"hex")};i.intToBuffer=jt;var Ft=function(e){return Buffer.allocUnsafe(e).fill(0)};i.zeros=Ft;var Be=function(e,t,r){let n=(0,i.zeros)(t);return r?e.length<t?(e.copy(n),n):e.slice(0,t):e.length<t?(e.copy(n,t-e.length),n):e.slice(-t)},zt=function(e,t){return(0,T.assertIsBuffer)(e),Be(e,t,!1)};i.setLengthLeft=zt;var Gt=function(e,t){return(0,T.assertIsBuffer)(e),Be(e,t,!0)};i.setLengthRight=Gt;var J=function(e){let t=e[0];for(;e.length>0&&t.toString()==="0";)e=e.slice(1),t=e[0];return e},Jt=function(e){return(0,T.assertIsBuffer)(e),J(e)};i.unpadBuffer=Jt;var Xt=function(e){return(0,T.assertIsArray)(e),J(e)};i.unpadArray=Xt;var Yt=function(e){return(0,T.assertIsHexString)(e),e=(0,I.stripHexPrefix)(e),"0x"+J(e)};i.unpadHexString=Yt;var Zt=function(e){if(e==null)return Buffer.allocUnsafe(0);if(Buffer.isBuffer(e))return Buffer.from(e);if(Array.isArray(e)||e instanceof Uint8Array)return Buffer.from(e);if(typeof e=="string"){if(!(0,I.isHexString)(e))throw new Error(`Cannot convert string to buffer. toBuffer only supports 0x-prefixed hex strings and this string was given: ${e}`);return Buffer.from((0,I.padToEven)((0,I.stripHexPrefix)(e)),"hex")}if(typeof e=="number")return(0,i.intToBuffer)(e);if(typeof e=="bigint"){if(e<BigInt(0))throw new Error(`Cannot convert negative bigint to buffer. Given: ${e}`);let t=e.toString(16);return t.length%2&&(t="0"+t),Buffer.from(t,"hex")}if(e.toArray)return Buffer.from(e.toArray());if(e.toBuffer)return Buffer.from(e.toBuffer());throw new Error("invalid type")};i.toBuffer=Zt;var Qt=function(e){return e=(0,i.toBuffer)(e),"0x"+e.toString("hex")};i.bufferToHex=Qt;function X(e){let t=(0,i.bufferToHex)(e);return BigInt(t==="0x"?0:t)}i.bufferToBigInt=X;function Y(e){return(0,i.toBuffer)("0x"+e.toString(16))}i.bigIntToBuffer=Y;var er=function(e){let t=Number(X(e));if(!Number.isSafeInteger(t))throw new Error("Number exceeds 53 bits");return t};i.bufferToInt=er;var tr=function(e){return BigInt.asIntN(256,X(e))};i.fromSigned=tr;var rr=function(e){return Y(BigInt.asUintN(256,e))};i.toUnsigned=rr;var nr=function(e){return typeof e!="string"||(0,I.isHexPrefixed)(e)?e:"0x"+e};i.addHexPrefix=nr;function sr(e,t=50){let r=Buffer.isBuffer(e)?e.toString("hex"):e;return r.length<=t?r:r.slice(0,t)+"\u2026"}i.short=sr;var or=function(e){let t=/^(00)+|(00)+$/g;if(e=(0,I.stripHexPrefix)(e),e.length%2!==0)throw new Error("Invalid non-even hex string input for toUtf8() provided");return Buffer.from(e.replace(t,""),"hex").toString("utf8")};i.toUtf8=or;var ir=function(e){if(Buffer.isBuffer(e))return`0x${e.toString("hex")}`;if(e instanceof Array){let t=[];for(let r=0;r<e.length;r++)t.push((0,i.baToJSON)(e[r]));return t}};i.baToJSON=ir;var ar=function(e){for(let[t,r]of Object.entries(e))if(r!==void 0&&r.length>0&&r[0]===0)throw new Error(`${t} cannot have leading zeroes, received: ${r.toString("hex")}`)};i.validateNoLeadingZeroes=ar;function $e(e){return Array.isArray(e)?e.map(t=>$e(t)):Buffer.from(e)}i.arrToBufArr=$e;function Oe(e){return Array.isArray(e)?e.map(t=>Oe(t)):Uint8Array.from(e??[])}i.bufArrToArr=Oe;var ur=e=>"0x"+e.toString(16);i.bigIntToHex=ur;function cr(e){return(0,i.unpadBuffer)(Y(e))}i.bigIntToUnpaddedBuffer=cr;function pr(e){return(0,i.unpadBuffer)((0,i.intToBuffer)(e))}i.intToUnpaddedBuffer=pr});var Ce={};ze(Ce,{any:()=>Ye,cancelled:()=>ut,chainDisconnected:()=>Ze,error:()=>Xe,internalError:()=>et,invalidInput:()=>Qe,methodNotFound:()=>tt,rateLimited:()=>it,resourceUnavailable:()=>rt,result:()=>Je,transactionRejected:()=>nt,unauthorized:()=>st,unsupportedMethod:()=>ot,userRejectedRequest:()=>at});c();p();var Je=(e,t)=>({jsonrpc:"2.0",id:e,result:t}),Xe=(e,t)=>({jsonrpc:"2.0",id:e,error:t}),Ye=(e,t)=>({...t,jsonrpc:"2.0",id:e}),Ze=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4901,message:t??"The Provider is not connected to the requested chain."}}),Qe=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32e3,message:t??"Missing or invalid parameters."}}),et=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32603,message:t??"Something went wrong."}}),tt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32601,message:t??"Method does not exist."}}),rt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32002,message:t??"Requested resource not available."}}),nt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32003,message:t??"Transaction creation failed."}}),st=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4100,message:t??"The requested method and/or account has not been authorized by the user."}}),ot=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4200,message:t??"The requested method is not supported."}}),it=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4290,message:t??"The requested method has been rate limited."}}),at=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4001,message:t??"User rejected the request."}}),ut=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32800,message:t??"The request was cancelled."}});c();p();c();p();var De=V(Te());function St(e,t){return{request:e,source:t,id:te()}}function wt(){return{parse(e){return Ct(e)}}}function Ct(e){function t(r,n,s){return async a=>{if(e.path&&a.source?.type==="DeepLinkRpcRequestSource"){let g=new URL(a.source.deepLinkUrl),h=g.host+g.pathname,R=(0,De.match)(e.path)(h);R&&a.request.params&&typeof a.request.params=="object"&&(a.request.params={...a.request.params,...R.params})}let u={...a,request:e.request.parse(a.request)},f=[];for(let g of n){let h=await g(u,r);if(h){if(typeof h!="function")return setTimeout(()=>{for(let y of f)y(h)},0),h;f.push(h)}}let l=e.response.parse(await s(u,r));if(l.id!==a.request.id){let g="Request id does not match response id";throw console.error(g,{request:a.request,response:l}),new Error(g)}return setTimeout(()=>{for(let g of f)g(l)},0),l}}return{context(r){return{use:(n,s)=>t(r,n,s)}},use:(r,n)=>t(void 0,r,n)}}c();p();var G=class{#e;constructor(t){this.#e=t}init(t,r){let n=new AbortController,{signal:s}=n,o=It(this.#e.routes,this.#e.concurrent);return{start:async()=>{if(s.aborted){console.warn("stream already closed");return}try{await t.pipeThrough(o,{signal:s}).pipeTo(r,{signal:s})}catch(a){s.aborted||console.error("RPC router stream error",a)}},stop:a=>{n.abort(a)}}}};function It(e,t){return new TransformStream({async transform(r,n){let s=async()=>{let o=e[r.request.method];if(!o){let a={jsonrpc:"2.0",id:r.request.id,error:{code:0,message:`${r.request.method} isn't implemented`}};return n.enqueue([r,a])}try{let a=await o(r);return n.enqueue([r,a])}catch(a){console.error(`RPC ROUTER: Unexpected error in method: ${r.request.method}, message: ${a?.message}`);let u={jsonrpc:"2.0",id:r.request.id,error:{code:-32603,message:"Unexpected error"}};return n.enqueue([r,u])}};t?s():await s()}})}c();p();c();p();var be=e=>{let t=new q,r=new oe({storage:t,getPassword:e}),n=se.fromStorage(t,r),s=new ie,o=new me({keyPair:{solana:fe(),eip155:pe(),bip122_p2tr:E(),bip122_p2wpkh:E(),bip122_p2sh:E(),bip122_p2pkh:E(),sui:le(),JWT:de()},ledger:ye(),seedVault:{type:"seedVault",async sign(){return ce("unsupportedOperation")}}}),a=()=>ae(t),u={generalStorage:t,secretsStorage:n,secureCache:ge({isEnabled:()=>!P("kill-vault-secure-cache"),generalStorage:t,secretsStorage:n}),fetchChainAvailability:a,keypairGenerator:s,vaultSigner:o};return{vault:he(u),getChainAvailability:a,encryptedStorage:n,storageEncryptionKeyManager:r}};c();p();var At=/^\.phantom-labs\.vault\.seed\.[0-9A-Fa-f]+$/,Et=/^\.phantom-labs\.vault\.privateKey\.[0-9A-Fa-f]+$/;async function ke(e){let t;try{if(t=await e.storageEncryptionKeyManager.hasPersistedDeviceEncryptionKey(),!t)return{status:"noMiddleEncryptionKey"}}catch{return{status:"errorRetrievingMiddleEncryptionKey"}}let r;try{r=(await e.vault.checkVaultIntegrity()).status}catch{return{status:"errorUnableToCheckVaultIntegrity"}}try{let n=await e.generalStorage.getAll(),[s,o]=await ve(e,n,At),[a,u]=await ve(e,n,Et);return{status:"hasMiddleEncryptionKey",vaultStatus:r,numberOfEncryptedSeeds:s,numberOfDecryptableSeeds:o,numberOfEncryptedPrivateKeys:a,numberOfDecryptablePrivateKeys:u}}catch{return{status:"errorUnableToCountDecryptableValues",vaultStatus:r}}}async function ve(e,t,r){let n=0,s=0;for(let[o,a]of Object.entries(t))if(!(!o.match(r)||!ne.safeParse(a).success)){n++;try{await e.secretsStorage.getSecureValue(o),s++}catch{}}return[n,s]}var cn="HAS_ONBOARDING_BEEN_OPENED",pn="EXTENSION_LOCKED",U=null,dn=()=>U,bt=e=>{U=e},fn=()=>{U=null},vt=()=>U??null,{vault:qe,getChainAvailability:ln,encryptedStorage:kt,storageEncryptionKeyManager:Pe}=be(vt),mn=async e=>!e||!await w.startSpan({name:"storageEncryptionKeyManager.verifyPassword"},()=>Pe.verifyPassword(e))?!1:(bt(e),!0),gn=async()=>{let e=await qe.deriveAddresses();return e&&(w.addBreadcrumb("account","\u2705 Derived new addresses in Vault","info"),await we.invalidateQueries({refetchType:"all"})),e},hn=async()=>{if(!P("kill-extension-storage-integrity-check"))try{let e=await ke({generalStorage:new q,secretsStorage:kt,storageEncryptionKeyManager:Pe,vault:qe});e.status!=="hasMiddleEncryptionKey"&&Se.capture("extensionStorageIntegrityCheck",{data:{extensionStorageIntegrityCheck:e}})}catch{}};c();p();var Z=V(He()),Ve=V(B()),dr=/^[0-9A-Fa-f]+$/gu;function Le(e){try{let t=(0,Ve.stripHexPrefix)(e);if(t.match(dr))return fr(t)}catch{return(0,Z.bufferToHex)(Buffer.from(e,"utf8"))}return(0,Z.bufferToHex)(Buffer.from(e,"utf8"))}var fr=e=>typeof e!="string"||e.match(/^-?0x/u)?e:e.match(/^-?0X/u)?e.replace("0X","0x"):e.startsWith("-")?e.replace("-","-0x"):`0x${e}`,lr=e=>{let t=Buffer.from(e.substring(2),"hex"),r=t.length===32?"hex":"utf8",n;switch(r){case"hex":n=Le(e);break;case"utf8":default:n=t.toString("utf8")}return n};c();p();c();p();var gr={UNSUPPORTED_DAPP:"autoConfirmReasonDappNotWhitelisted",DISABLED:"autoConfirmReasonSessionNotActive",RATE_LIMIT_EXCEEDED:"autoConfirmReasonRateLimited",SIMULATION_FAILED:"autoConfirmReasonSimulationFailed",UNSUPPORTED_NETWORK_ID:"autoConfirmReasonUnsupportedNetwork",TAB_NOT_FOCUSED:"autoConfirmReasonTabNotFocused",WALLET_LOCKED:"autoConfirmReasonNotUnlocked"},hr=e=>e?gr[e]:void 0;c();p();c();p();c();p();var Q=e=>`/auto-confirm/v1/${e}`;async function Ke(e){return k.isEVMNetworkID(e.chainId)?(await b.api().post(Q("transaction"),{txObjects:e.txObjects,chainId:e.chainId,domain:e.domain})).data?.isEligible===!0:k.isSolanaNetworkID(e.chainId)?(await b.api().post(Q("transaction"),{transactions:e.transactions,chainId:e.chainId,domain:e.domain})).data?.isEligible===!0:!1}async function We(e){if(k.isEVMNetworkID(e.chainId)){let t=JSON.parse(JSON.stringify(e.data));return delete t.message,delete t.primaryType,delete t.types,(await(await b.api().post(Q("message"),{chainId:e.chainId,domain:e.domain,data:[t]})).data)?.isEligible===!0}return!1}var yr=10,$=[],ee=class{constructor(t){this.storage=t}executedChecksAudit=[];isDappWhitelistedForMessage=We;isDappWhitelistedForTransaction=Ke;async isEthTransactionAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!=="OK")return n;if(!(await this.isDappWhitelistOverridden()||await this.isDappWhitelistedForTransaction({chainId:t.networkID,domain:v(t.url.origin),txObjects:t.data})))return{...n,status:"UNSUPPORTED_DAPP",auditTrail:this.executedChecksAudit};let{success:o,...a}=await this.didPassEthTransactionSimulation(t,r);return o?{...n,...a,status:"OK",auditTrail:this.executedChecksAudit}:{...n,...a,status:"SIMULATION_FAILED",auditTrail:this.executedChecksAudit}}async isEthMessageAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);return n.status!=="OK"?n:await this.isDappWhitelistOverridden()||await this.isDappWhitelistedForMessage({chainId:t.networkID,domain:v(t.url.origin),data:t.data})?await this.didPassEthMessageSimulation(t,r)?{...n,status:"OK",auditTrail:this.executedChecksAudit}:{...n,status:"SIMULATION_FAILED",auditTrail:this.executedChecksAudit}:{...n,status:"UNSUPPORTED_DAPP",auditTrail:this.executedChecksAudit}}async isSolTransactionAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!=="OK")return n;if(!(await this.isDappWhitelistOverridden()||await this.isDappWhitelistedForTransaction({chainId:t.networkID,domain:v(t.url.origin),transactions:t.data})))return{...n,status:"UNSUPPORTED_DAPP",auditTrail:this.executedChecksAudit};let{success:o,...a}=await this.didPassSolTransactionSimulation(t,r);return o?{...n,...a,status:"OK",auditTrail:this.executedChecksAudit}:{...n,...a,status:"SIMULATION_FAILED",auditTrail:this.executedChecksAudit}}isSolMessageAutoConfirmable(t){return this.executedChecksAudit=[],Promise.resolve({status:"UNIMPLEMENTED"})}async didPassGenericChecks(t){try{if(!await this.isFeatureEnabled())return{status:"FEATURE_KILLED"};if(!await this.isWalletUnlocked())return{status:"WALLET_LOCKED"};if(!await this.isTabFocused(t.url.origin))return{status:"TAB_NOT_FOCUSED"};if(!await this.isAutoConfirmEnabledInUserSettings({origin:t.url.origin,networkID:t.networkID,accountIdentifier:t.accountIdentifier}))return{status:"DISABLED"};let r=await this.isAutoConfirmSessionActive(t.accountIdentifier,t.url.origin);return r.success?await this.isNotRateLimited()?{status:"OK",sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}:{status:"RATE_LIMIT_EXCEEDED",sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}:{status:"SESSION_EXPIRED",sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}}catch{return{status:"UNKNOWN"}}}async isAutoConfirmEnabledInUserSettings({origin:t,accountIdentifier:r,networkID:n}){return this.executedChecksAudit.push("IS_AUTO_CONFIRM_ENABLED_IN_USER_SETTINGS"),(await L(this.storage,r,t))?.networks?.[n]===!0}isNotRateLimited(){this.executedChecksAudit.push("IS_NOT_RATE_LIMITED");let t=$.findIndex(r=>r<=Date.now()-6e4);return t>-1&&$.splice(t),$.length>=yr?!1:($.push(Date.now()),!0)}async isAutoConfirmSessionActive(t,r){this.executedChecksAudit.push("IS_AUTO_CONFIRM_SESSION_ACTIVE");let n=await L(this.storage,t,r),s=Re(n);return{sessionStartTime:n.sessionStartTime,sessionMaxDuration:n.maxSessionDuration,success:s}}async didPassEthTransactionSimulation(t,r){this.executedChecksAudit.push("DID_PASS_ETH_TRANSACTION_SIMULATION");try{let n=await K(r.locale,r.deviceId,{networkID:t.networkID,type:"transaction",url:t.url?.href,userAccount:t.userAccountAddress,params:{transactions:t.data,userAddresses:[]}});return _e(n)}catch{return{success:!1}}}async didPassSolTransactionSimulation(t,r){this.executedChecksAudit.push("DID_PASS_SOL_TRANSACTION_SIMULATION");try{let n=await K(r.locale,r.deviceId,{networkID:t.networkID,type:"transaction",url:t.url.href,userAccount:t.userAccountAddress,params:{transactions:t.data,method:"signAndSendTransaction"}});return _e(n)}catch{return{success:!1}}}async didPassEthMessageSimulation(t,r){this.executedChecksAudit.push("DID_PASS_ETH_MESSAGE_SIMULATION");try{let n=await xe(r.locale,r.deviceId,{params:{message:"0x"+Buffer.from(JSON.stringify(t.data)).toString("hex")},type:"message",userAccount:t.userAccountAddress,networkID:t.networkID,url:t.url?.href});return Rr(n)}catch{return!1}}};function _e(e){let t=!!e.warnings.find(s=>s.severity<=3),r=!!e.block,n=e.expectedChanges.map(s=>s.type==="AssetChange"&&s.asset.usdValue||0).reduce((s,o)=>s+o,0);return{success:!t&&!r&&!e.error,dollarValue:parseFloat((n||0).toFixed(6))}}function Rr(e){let t=!!e.warnings.find(n=>n.severity<=3),r=!!e.block;return!t&&!r&&!e.error}c();p();var je=7,ss=re(ue,e=>new O(e)),O=class{#e;constructor(t){this.#e=t}onAutoConfirmSettingsChanged({origin:t,networkID:r,enabled:n,sessionStartTime:s,maxSessionDuration:o,view:a}){w.addBreadcrumb(`Auto-Confirm: ${n?"Enabling":"Disabling"} network ID ${r}`,"autoConfirm","info"),this.#e.capture("autoConfirmSettingsChanged",{data:{origin:t,networkId:r,enabled:n,sessionStartTime:n?s:void 0,maxSessionDuration:n?o:void 0,view:a}})}transactionAutoConfirmed(t){let r={type:"transaction",data:t};return t.autoConfirm.auditTrail?.length&&t.autoConfirm.auditTrail.length<je&&(t.autoConfirm.suspectSettingsTamper=!0),w.addBreadcrumb(`Auto-Confirm: transaction on origin ${t.origin} for network ${t.networkId} auto-confirmed`,"autoConfirm","info"),t.autoConfirm.suspectSettingsTamper&&w.addBreadcrumb("Auto-Confirm: suspected tampering with settings...","autoConfirm","info"),this.#e.capture("transactionAutoConfirmed",r)}messageAutoConfirmed(t){let r={type:"message",data:t};return t.autoConfirm.auditTrail?.length&&t.autoConfirm.auditTrail.length<je&&(t.autoConfirm.suspectSettingsTamper=!0),w.addBreadcrumb(`Auto-Confirm: message on origin ${t.origin} for network ${t.networkId} auto-confirmed`,"autoConfirm","info"),t.autoConfirm.suspectSettingsTamper&&w.addBreadcrumb("Auto-Confirm: suspected tampering with settings...","autoConfirm","info"),this.#e.capture("transactionAutoConfirmed",r)}};export{St as a,wt as b,G as c,Ce as d,cn as e,pn as f,dn as g,bt as h,fn as i,qe as j,ln as k,kt as l,Pe as m,mn as n,gn as o,hn as p,ee as q,ss as r,O as s,hr as t,Le as u,lr as v};
//# sourceMappingURL=chunk-Q7HXBC5W.js.map
